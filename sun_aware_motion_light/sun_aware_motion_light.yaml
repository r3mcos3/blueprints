blueprint:
  name: âœ¨ğŸ’¡ Sun-aware Motion Light Control ğŸƒâ€â™‚ï¸â˜€ï¸
  description: >-
    ğŸ’¡ Smart Light Control for Motion ğŸƒâ€â™‚ï¸. Turns on a light with adjustable brightness when motion is detected.
    Optionally, it can use different brightness levels depending on the sun's position ğŸŒ….
    Version: 1.0
  domain: automation
  source_url: https://github.com/r3mconl/blueprints/blob/main/sun_aware_motion_light/sun_aware_motion_light.yaml
  author: r3mcos3
  homeassistant:
    min_version: 2025.12.0
  input:
    motion_sensor:
      name: ğŸƒâ€â™‚ï¸ Motion Sensor
      description: The ğŸƒâ€â™‚ï¸ motion sensor that detects presence.
      selector:
        entity:
          domain: binary_sensor
          device_class: motion
    target_light:
      name: ğŸ’¡ Target Light
      description: The ğŸ’¡ light or group of lights controlled by this automation.
      selector:
        target:
          entity:
            domain: light
    default_brightness:
      name: ğŸ”† Default Brightness
      description: The ğŸ”† brightness percentage to use when sun-aware mode is disabled.
      default: 80
      selector:
        number:
          min: 0
          max: 100
          unit_of_measurement: "%"
    sun_aware_settings:
      name: â˜€ï¸ Sun-aware Settings
      description: Configure brightness levels ğŸŒ“ based on the sun's position â˜€ï¸ğŸŒ™.
      collapsed: true
      icon: mdi:weather-sunny
      input:
        sun_aware_enabled:
          name: â˜€ï¸ Sun-aware Mode
          description: Enable ğŸŸ¢ to use different brightness levels for day and night. If ğŸ”´ disabled, a single brightness level is used.
          selector:
            boolean:
          default: true
        brightness_day:
          name: â˜€ï¸ Brightness (Day)
          description: The âœ¨ brightness percentage for when the sun â˜€ï¸ is up (only if sun-aware mode is enabled).
          default: 100
          selector:
            number:
              min: 0
              max: 100
              unit_of_measurement: "%"
        brightness_night:
          name: ğŸŒ™ Brightness (Night)
          description: The âœ¨ brightness percentage for when the sun ğŸŒ™ is down (only if sun-aware mode is enabled).
          default: 10
          selector:
            number:
              min: 0
              max: 100
              unit_of_measurement: "%"
    turn_off_delay:
      name: Turn-off delay
      description: The â±ï¸ wait time in minutes before the light turns off after no motion is detected. Set to 0 for no delay.
      default: 5
      selector:
        number:
          min: 0
          max: 100
          step: 1
          unit_of_measurement: minutes
          mode: slider

trigger:
  - platform: state
    entity_id: !input motion_sensor
    from: "off"
    to: "on"
    id: motion_on
  - platform: state
    entity_id: !input motion_sensor
    from: "on"
    to: "off"
    id: motion_off
    for:
      hours: 0
      minutes: !input turn_off_delay
      seconds: 0

variables:
  sun_aware_enabled: !input sun_aware_enabled

action:
  - choose:
      # Motion detected
      - conditions:
          - condition: trigger
            id: motion_on
        sequence:
          - choose:
              # Sun-aware mode is enabled
              - conditions:
                  - condition: template
                    value_template: "{{ sun_aware_enabled }}"
                sequence:
                  # Original sun-aware logic
                  - choose:
                      - conditions:
                          - condition: state
                            entity_id: sun.sun
                            state: "above_horizon"
                        sequence:
                          - service: light.turn_on
                            target: !input target_light
                            data:
                              brightness_pct: !input brightness_day
                    default:
                      - service: light.turn_on
                        target: !input target_light
                        data:
                          brightness_pct: !input brightness_night
            # Sun-aware mode is disabled
            default:
              - service: light.turn_on
                target: !input target_light
                data:
                  brightness_pct: !input default_brightness

      # Motion stopped
      - conditions:
          - condition: trigger
            id: motion_off
        sequence:
          - service: light.turn_off
            target: !input target_light
mode: restart
