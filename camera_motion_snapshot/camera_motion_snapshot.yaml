blueprint:
  name: ğŸ“¸ Camera Snapshot on Motion to Telegram ğŸ¤–
  description: >
    ğŸš€ Automatically capture a snapshot from your camera ğŸ“· when motion is detected ğŸƒâ€â™‚ï¸ and send it instantly via your Telegram bot ğŸ“¨.
    
    âœ¨ Features:
    - ğŸ“¸ Instant high-quality snapshot.
    - ğŸƒâ€â™‚ï¸ Triggered by any motion sensor.
    - ğŸ¤– Supports multiple Telegram bots via Config Entry and Chat ID.
    - âœï¸ Fully customizable message caption.
    - â±ï¸ Adjustable timeout (cooldown) between snapshots.

    Version: 1.7.0 ğŸ·ï¸
  domain: automation
  author: r3mcos3
  source_url: https://github.com/r3mcos3/blueprints/blob/main/camera_motion_snapshot/camera_motion_snapshot.yaml
  input:
    motion_sensor:
      name: ğŸƒâ€â™‚ï¸ Motion Sensor
      description: ğŸ” Select the sensor that should trigger the snapshot.
      selector:
        entity:
          domain: binary_sensor
          device_class: motion
    camera:
      name: ğŸ“· Camera
      description: ğŸ–¼ï¸ Choose the camera to take the snapshot from.
      selector:
        entity:
          domain: camera
    telegram_bot_entry:
      name: ğŸ¤– Telegram Bot Instance
      description: ğŸ”Œ Select the Telegram Bot integration instance to use.
      selector:
        config_entry:
          integration: telegram_bot
    target_chat_id:
      name: ğŸ†” Target Chat ID
      description: âœ‰ï¸ The specific Telegram Chat ID to send the photo to.
      selector:
        text: {}
    message_caption:
      name: âœï¸ Message Caption
      description: ğŸ“ The full message to be sent as a caption with the photo.
      default: "ğŸš¨ Motion detected! ğŸ“¸"
      selector:
        text: {}
    snapshot_path:
      name: ğŸ“‚ Snapshot Path
      description: ğŸ’¾ Local path to save the image (e.g., /config/www/snapshot.jpg).
      default: "/config/www/snapshot_motion.jpg"
      selector:
        text: {}
    timeout:
      name: â±ï¸ Timeout (Cooldown)
      description: â³ The time to wait after a snapshot before allowing another one (in seconds).
      default: 60
      selector:
        number:
          min: 0
          max: 3600
          unit_of_measurement: seconds
          mode: box

variables:
  target_chat_id_var: !input target_chat_id

trigger:
  - platform: state
    entity_id: !input motion_sensor
    from: "off"
    to: "on"

mode: single

action:
  - service: camera.snapshot
    target:
      entity_id: !input camera
    data:
      filename: !input snapshot_path
  - delay: "00:00:02"
  - service: telegram_bot.send_photo
    data:
      target: "{{ target_chat_id_var }}"
      file: !input snapshot_path
      caption: !input message_caption
  - delay: !input timeout
